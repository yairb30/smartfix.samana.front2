<!-- Contenido principal -->
<div class="dashboard-container">
  @if (isLoadingDashboard) {
    <div class="loading-overlay">
      <app-spinner 
        size="large" 
        message="Cargando dashboard..."
        color="primary">
      </app-spinner>
    </div>
  } @else {
    <main class="main-content">
      <!-- Header del Dashboard -->
      <div class="dashboard-header">
        <div class="header-content">
          <h1 class="dashboard-title">
            <span class="title-icon">ğŸ“Š</span>
              SmartFix SamanÃ¡
          </h1>
          <p class="dashboard-subtitle">Panel de control y estadÃ­sticas del sistema</p>
        </div>
        <div class="header-date">
          <span class="date-icon">ğŸ“…</span>
          <span>{{ currentDate | date:'fullDate' }}</span>
        </div>
      </div>

      <!-- Tarjetas de Resumen General -->
      <div class="summary-grid">
        @if (isLoadingStats) {
          <div class="stats-loading">
            <app-spinner 
              size="medium" 
              message="Cargando estadÃ­sticas..."
              color="primary">
            </app-spinner>
          </div>
        } @else {
          <div class="summary-card customers">
            <div class="card-header">
              <div class="card-icon">ğŸ‘¥</div>
              <div class="card-info">
                <h3>Clientes</h3>
                <p class="card-count">{{ totalCustomers }}</p>
              </div>
            </div>
            <div class="card-footer">
              <span class="status-text">Total registrados</span>
              <span class="trend-indicator positive">â†—ï¸ +{{ newCustomersThisMonth }}</span>
            </div>
          </div>

          <div class="summary-card phones">
            <div class="card-header">
              <div class="card-icon">ğŸ“±</div>
              <div class="card-info">
                <h3>Dispositivos</h3>
                <p class="card-count">{{ totalPhones }}</p>
              </div>
            </div>
            <div class="card-footer">
              <span class="status-text">Modelos registrados</span>
              <span class="trend-indicator neutral">ğŸ“Š CatÃ¡logo</span>
            </div>
          </div>

          <div class="summary-card repairs">
            <div class="card-header">
              <div class="card-icon">ğŸ› ï¸</div>
              <div class="card-info">
                <h3>Reparaciones</h3>
                <p class="card-count">{{ totalRepairs }}</p>
              </div>
            </div>
            <div class="card-footer">
              <span class="status-text">Total procesadas</span>
              <span class="trend-indicator positive">â†—ï¸ +{{ repairsThisMonth }}</span>
            </div>
          </div>

          <div class="summary-card parts">
            <div class="card-header">
              <div class="card-icon">ğŸ”©</div>
              <div class="card-info">
                <h3>Repuestos</h3>
                <p class="card-count">{{ totalParts }}</p>
              </div>
            </div>
            <div class="card-footer">
              <span class="status-text">En inventario</span>
              <span class="trend-indicator neutral">ğŸ“¦ Stock</span>
            </div>
          </div>
        }
      </div>

      <!-- SecciÃ³n de EstadÃ­sticas del Mes -->
      <div class="monthly-stats">
        <div class="stats-header">
          <h2 class="stats-title">
            <span class="stats-icon">ğŸ“ˆ</span>
            Resumen del Ãšltimo Mes
          </h2>
          <div class="stats-period">
            <span class="period-icon">ğŸ—“ï¸</span>
            <span>{{ currentMonth }}</span>
          </div>
        </div>

        <div class="stats-grid">
          <!-- Reparaciones por Estado -->
          <div class="stat-card repairs-status">
            <div class="stat-header">
              <h3>Reparaciones por Estado</h3>
              <span class="stat-icon">ğŸ“Š</span>
            </div>
            <div class="stat-content">
              @if (isLoadingCharts) {
                <div class="chart-loading">
                  <app-spinner 
                    size="small" 
                    message="Cargando grÃ¡ficos..."
                    color="secondary">
                  </app-spinner>
                </div>
              } @else {
                <div class="status-item">
                  <div class="status-indicator pending"></div>
                  <span class="status-label">Pendientes</span>
                  <span class="status-count">{{ repairsByStatus.pending || 0 }}</span>
                </div>
                <div class="status-item">
                  <div class="status-indicator in-progress"></div>
                  <span class="status-label">En Proceso</span>
                  <span class="status-count">{{ repairsByStatus.inProgress || 0 }}</span>
                </div>
                <div class="status-item">
                  <div class="status-indicator completed"></div>
                  <span class="status-label">Completadas</span>
                  <span class="status-count">{{ repairsByStatus.completed || 0 }}</span>
                </div>
                <div class="status-item">
                  <div class="status-indicator delivered"></div>
                  <span class="status-label">Entregadas</span>
                  <span class="status-count">{{ repairsByStatus.delivered || 0 }}</span>
                </div>
              }
            </div>
          </div>

          <!-- Dispositivos MÃ¡s Reparados -->
          <div class="stat-card popular-devices">
            <div class="stat-header">
              <h3>Dispositivos MÃ¡s Reparados</h3>
              <span class="stat-icon">ğŸ†</span>
            </div>
            <div class="stat-content">
              @if (isLoadingCharts) {
                <div class="chart-loading">
                  <app-spinner 
                    size="small" 
                    message="Analizando dispositivos..."
                    color="secondary">
                  </app-spinner>
                </div>
              } @else {
                @for (device of topRepairedDevices; track device.id) {
                  <div class="device-item">
                    <div class="device-info">
                      <span class="device-icon">ğŸ“±</span>
                      <div class="device-details">
                        <span class="device-name">{{ device.brand }} {{ device.model }}</span>
                        <span class="device-count">{{ device.repairCount }} reparaciones</span>
                      </div>
                    </div>
                    <div class="device-progress">
                      <div class="progress-bar" [style.width.%]="(device.repairCount / maxRepairCount) * 100"></div>
                    </div>
                  </div>
                }
                @if (topRepairedDevices.length === 0) {
                  <div class="no-data">
                    <span class="no-data-icon">ğŸ“­</span>
                    <p>No hay datos de reparaciones este mes</p>
                  </div>
                }
              }
            </div>
          </div>

          <!-- MÃ©tricas de Rendimiento -->
          <div class="stat-card performance-metrics">
            <div class="stat-header">
              <h3>MÃ©tricas de Rendimiento</h3>
              <span class="stat-icon">âš¡</span>
            </div>
            <div class="stat-content">
              @if (isLoadingCharts) {
                <div class="chart-loading">
                  <app-spinner 
                    size="small" 
                    message="Calculando mÃ©tricas..."
                    color="secondary">
                  </app-spinner>
                </div>
              } @else {
                <div class="metric-item">
                  <div class="metric-icon">â±ï¸</div>
                  <div class="metric-info">
                    <span class="metric-label">Tiempo Promedio</span>
                    <span class="metric-value">{{ averageRepairTime }} dÃ­as</span>
                  </div>
                </div>
                <div class="metric-item">
                  <div class="metric-icon">âœ…</div>
                  <div class="metric-info">
                    <span class="metric-label">Tasa de Ã‰xito</span>
                    <span class="metric-value">{{ successRate }}%</span>
                  </div>
                </div>
                <div class="metric-item">
                  <div class="metric-icon">ğŸ˜Š</div>
                  <div class="metric-info">
                    <span class="metric-label">SatisfacciÃ³n</span>
                    <span class="metric-value">{{ customerSatisfaction }}/5</span>
                  </div>
                </div>
              }
            </div>
          </div>

          <!-- Actividad Reciente -->
          <div class="stat-card recent-activity">
            <div class="stat-header">
              <h3>Actividad Reciente</h3>
              <span class="stat-icon">ğŸ””</span>
            </div>
            <div class="stat-content">
              @for (activity of recentActivities; track activity.id) {
                <div class="activity-item">
                  <div class="activity-icon" [class]="activity.type">
                    {{ getActivityIcon(activity.type) }}
                  </div>
                  <div class="activity-info">
                    <span class="activity-text">{{ activity.description }}</span>
                    <span class="activity-time">{{ activity.timestamp | date:'short':'es' }}</span>
                  </div>
                </div>
              }
              @if (recentActivities.length === 0) {
                <div class="no-data">
                  <span class="no-data-icon">ğŸ”•</span>
                  <p>No hay actividad reciente</p>
                </div>
              }
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Repairs Section -->
      <div class="recent-repairs-section">
        <div class="section-header">
          <h2 class="section-title">
            <span class="section-icon">ğŸ”§</span>
            Reparaciones Recientes
          </h2>
          <a href="/dashboard/repairs" class="view-all-link">
            Ver todas â†’
          </a>
        </div>

        @if (isLoadingCharts) {
          <div class="loading-container">
            <app-spinner
              size="medium"
              message="Cargando reparaciones..."
              color="primary">
            </app-spinner>
          </div>
        } @else {
          <div class="repairs-grid">
            @for (repair of recentRepairs; track repair.id) {
              <div class="repair-card">
                <div class="repair-header">
                  <div class="repair-state" [style.background-color]="getStateColor(repair.state)">
                    <span class="state-icon">{{ getStateIcon(repair.state) }}</span>
                    <span class="state-text">{{ repair.state }}</span>
                  </div>
                  <span class="repair-date">{{ formatDate(repair.date) }}</span>
                </div>

                <div class="repair-body">
                  <div class="repair-info">
                    <div class="info-row">
                      <span class="info-icon">ğŸ‘¤</span>
                      <span class="info-text">{{ repair.customer.name }} {{ repair.customer.lastname }}</span>
                    </div>
                    <div class="info-row">
                      <span class="info-icon">ğŸ“±</span>
                      <span class="info-text">{{ repair.phone.brand }} {{ repair.phone.model }}</span>
                    </div>
                    <div class="info-row fault-row">
                      <span class="info-icon">âš ï¸</span>
                      <span class="info-text fault-text">{{ repair.fault }}</span>
                    </div>
                  </div>
                </div>

                <div class="repair-footer">
                  <a [href]="'/dashboard/repairs/edit/' + repair.id" class="view-repair-link">
                    Ver detalles â†’
                  </a>
                </div>
              </div>
            }

            @if (recentRepairs.length === 0) {
              <div class="no-data">
                <span class="no-data-icon">ğŸ“­</span>
                <p>No hay reparaciones recientes</p>
              </div>
            }
          </div>
        }
      </div>

      <!-- Quick Actions Section -->
      <div class="quick-actions-section">
        <div class="section-header">
          <h2 class="section-title">
            <span class="section-icon">âš¡</span>
            Acciones RÃ¡pidas
          </h2>
        </div>

        <div class="actions-grid">
          <a href="/dashboard/repairs/new" class="action-card">
            <div class="action-icon">ğŸ› ï¸</div>
            <div class="action-content">
              <h3>Nueva ReparaciÃ³n</h3>
              <p>Registrar nueva orden de reparaciÃ³n</p>
            </div>
          </a>

          <a href="/dashboard/customers/new" class="action-card">
            <div class="action-icon">ğŸ‘¥</div>
            <div class="action-content">
              <h3>Nuevo Cliente</h3>
              <p>Agregar cliente al sistema</p>
            </div>
          </a>

          <a href="/dashboard/phones/new" class="action-card">
            <div class="action-icon">ğŸ“±</div>
            <div class="action-content">
              <h3>Nuevo Dispositivo</h3>
              <p>Registrar modelo de dispositivo</p>
            </div>
          </a>

          <a href="/dashboard/parts/new" class="action-card">
            <div class="action-icon">ğŸ”©</div>
            <div class="action-content">
              <h3>Nuevo Repuesto</h3>
              <p>Agregar repuesto al inventario</p>
            </div>
          </a>
        </div>
      </div>
    </main>
  }
</div>
